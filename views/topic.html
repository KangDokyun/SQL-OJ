<!DOCTYPE html>
<html lang="en">
<head>
	<title>Topic</title>
	<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="js/jquery.min.js"></script>
	<!-- Custom Theme files -->
	<!--theme-style-->
	<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />  
	<!--//theme-style-->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="" />
	<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
	<!---->
	<script src="js/bootstrap.min.js"></script>
	<link href='http://fonts.googleapis.com/css?family=Catamaran:400,100,300,500,700,600,800,900' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
</head>
<body>
	<div class="header head1">
		<div class="container">
			<div class="head-top">
				<div class="logo">
					<a href="/index"><img src="/images/bo.png" alt="" title="SQL-OJ"></a>
				</div>
				<div class="login">
					<% if(user==null){ %>
					<ul id='unlogin-area' class="nav-login">
						<li><a href="#" data-toggle="modal" data-target="#myModal1">Login</a></li>
						<li><a href="#" data-toggle="modal" data-target="#myModal2">Signup</a></li>
					</ul>
					<% }else{ %>
					<ul id='login-area' class='nav-login'>
						<li><a id="userinfo">Hello! <%- user.Account%></a></li>
						<li><a href="/logout" id="logout-btn">Logout</a></li>
					</ul>
					<% } %>
				</div>
				<div class="clearfix"></div>
			</div>
		</div>
		<!-- login -->
		<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop="static">
			<div class="modal-dialog" role="document">
				<div class="modal-content modal-info">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                        
					</div>
					<div class="modal-body modal-spa">
						<div class="login-grids">

							<div class="login-right">

								<h3>Signin with your account </h3>
								<input id="uname1" type="text" value="Enter your mobile number or Email" name="uname" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Enter your mobile number or Email';}" required="">    
								<input id="upwd1" type="password" value="Password" name="Password" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Password';}" required="">
								<input id="login-btn" type="submit" value="SIGNIN" >

							</div>

							<p id="login-result"></p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- //login -->
		<!-- signup -->
		<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content modal-info">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                        
					</div>
					<div class="modal-body modal-spa">
						<div class="login-grids">

							<div class="login-right">
								<h3>Create your account </h3>
								<input id='uname2' type="text" value="Name" name="Name" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Name';}" required="">   
								<input id='upwd2' type="password" value="Password" name="Password" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Password';}" required="">    
								<input id='upwd3' type="password" value="Password" name="Password" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = ' Confirm Your Password';}" required="">  
								<input id='register-btn' type="submit" value="CREATE ACCOUNT" >
							</div>

							<p id='register-result'></p>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- //signup -->

		<div class="nav-top">
			<div class="container">
				<div class="nav1">
					<div class="navbar1">
						<!-- Brand and toggle get grouped for better mobile display -->
						<div class="navbar-header">
							<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" >
								<span class="sr-only">Toggle navigation</span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>

						</div>
						<!-- Collect the nav links, forms, and other content for toggling -->
						<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
							<ul class="nav navbar-nav cl-effect-8">
								<li><a href="/index">Home </a></li>
                            	<li><a href="/problemlist" >Problemlist</a></li>
                            	<li><a href="/user">User</a></li>
                            	<li><a class="active">Discuss</a></li>
                            	<li><a>Reply</a></li>
							</ul>
						</div><!-- /.navbar-collapse -->
					</div>
					<!-- start search-->
					<ul class="social-ic">
						<li><a href="#"><i></i></a></li>
						<li><a href="#"><i class="ic"></i></a></li>
						<li><a href="#"><i class="ic1"></i></a></li>
						<li><a href="#"><i class="ic2"></i></a></li>
					</ul>
					<div class="clearfix"></div>
				</div> 
			</div> 
		</div> 
	</div> 

	
	<div class="container">
		<div class="page">
			<div class="typo-head">
				<h3> Topics of Problem<%= pid %></h3>
			</div>
			<div class="table-responsive ">
				<table class="table table-bordered table-striped">
					<colgroup>
					<col class="col-xs-1">
					<col class="col-xs-5">
					<col class="col-xs-1">
					<col class="col-xs-1">
					<% if(isAdmin){ %>
					<col class="col-xs-1">
					<% } %>
				</colgroup>
				<thead>
					<tr>
						<th>index</th>
						<th>Title</th>
						<th>Author</th>
						<th>Time</th>
						<% if(isAdmin){ %>
							<th>Admin</th>
						<% } %>
					</tr>
				</thead>
				<tbody>
				<script type="text/javascript">
					function deleteTopic(topic_id){
						$.ajax({
							url:'/deleteTopic'+topic_id,
							type:'POST',
							success: function(data){
								if(data.error)
									alert("Delete Failed");
								else location.reload();
							}
						})
					}
				</script>
					<% for(var i=0;i<Topics.length;i++){ %>
					<tr>
						<th scope="row"><%= i+1 %></th>
						<td><a href="/reply<%=Topics[i].topic_id%>"><%= Topics[i].title %></a></td>
						<td><%= Topics[i].account %></td>
						<td><%= Topics[i].create_time %></td>
						<% if(isAdmin){ %>
						<td>
							<button type="button" onclick="deleteTopic(<%= Topics[i].topic_id %>)" class="btn btn-1 btn-danger">Delete</button>
						</td>
						<% } %>
					</tr>
					<% } %>
				</tbody>
			</table>
		</div>
		<!--
		<% if(!isAdmin){ %>
		<div style="margin:50px auto;width: 900px;" class="container">
			<% Topics.forEach(function(topic, index){ %>
			<div class="panel  panel-info">
				<div class="panel-heading">
					<button type="button" class="btn btn-info btn-sm">
						<span class="glyphicon glyphicon-user">Author </span>
					</button>&nbsp&nbsp<a href="#" style="color:black"><%=topic.account %></a>		
					<button type="button" class="btn btn-info btn-sm">
						<span class="glyphicon glyphicon-calendar">Time </span> 
					</button>&nbsp&nbsp<%=topic.create_time %>
				</div>
				<div class="panel-body">
					<a href="/reply/<%=topic.PID%>/<%=topic.topic_id%>" target="_blank" style="color:#000033"> <%=topic.title %></a>
				</div>
			</div>
			<% }) %>
		</div>
		<% }else{ %>
		<div class="col-lg-8 col-lg-offset-2">
			<table class="table table-bordered table-hover table-striped">
				<thead>
					<tr>
						<th class="col-lg-5">Title</th>
						<th class="col-lg-2">By</th>
						<th class="col-lg-2">Time</th>
						<th class="col-lg-1">Delete</th>
					</tr>
					<% Topics.forEach(function(topic, index){ %>
					<tr>
						<td> <a href="/reply/<%=topic.topic_id%>" > <%=topic.title %></a></td>
						<td> <a href="#"><%=topic.account %></a> </td> 
						<td> <%=topic.create_time %> </td> 
						<td> <div class="li-del" >
							<a href="/delFromTopic/<%=topic.PID%>/<%=topic.topic_id%>" class="btn btn-danger btn-xs" >删除主题</a>
						</div></td>
					</tr>
					<% }) %>
				</thead>
			</table>
		</div>
		<% }%>
		-->
		<hr>
		<div class="container" style="margin:50px auto;width: 600px;">
			<h3 style="color:#336666;"><b>Start a new topic:</h3>
			<form class="form-horizontal" role="form" id="newtopic">
				<div class="form-group">
					<input type="text" class="form-control" id="newtitle" placeholder="Input Title Here"/>
				</div>
				<div class="form-group">
					<textarea class="form-control" id="newcontent" rows="5" cols="20" placeholder="Input Content"></textarea>
				</div></b>
				<div class="form-group">
					<input type="submit" value="POST" class="btn btn-info btn-block" >
				</div>
			</form>
		</div>
	</div>
</div>
<!--footer-->
<div class="footer">
	<div class="container">
		<div class="col-md-6 footer-left">
			<h3>Information</h3>
			<p class="para">这款应用可以帮助SQL学习者进行数据库实例操作练习。更具体地说，这是一款能够提供数据库操作题目，并对用户答案的正确性和效率进行判断的软件系统。除此之外，这款应用还额外提供用户讨论区，使用户能够对难以解答的题目进行讨论学习。</p>
		</div>
		<div class="col-md-6 footer-right">
			<h3>Contact Us</h3>
			<ul class="con-icons">
				<li><span class="glyphicon glyphicon-phone" aria-hidden="true"></span>贝克街-23号（胥雅雯 刘雨瑶 陈明洁）</li>
				<li><a href="mailto:info@example.com"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>694189706@qq.com</a></li>
			</ul>
			<p class="copy-right">Copyright &copy; 2016.Company name All rights reserved.</p>
		</div>
		<div class="clearfix"></div>
	</div>
</div>
<!--//footer-->
<script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/bootstrap.min.js" type="text/javascript"></script>
<script type="text/javascript">
	$("#newtopic").bind("submit",function(){
		var title=$("#newtitle").val();
		var content=$("#newcontent").val();
		$.ajax({
			type:"POST",
			data:{
				"title":title,
				"content":content
			},
			success: function(data){
				if(data.error){
					alert(data.error);
				}
				else location.reload();
			}
		})
	})
</script>
</body>
</html>